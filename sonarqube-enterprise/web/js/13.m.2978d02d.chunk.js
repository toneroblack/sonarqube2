(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1164:function(e,t,a){"use strict";a.d(t,"a",(function(){return K}));var n=a(2),r=a(548),i=a(365),l=a(312),c=a(331),s=a.n(c),o=a(322),u=a(319),m=a.n(u),p=a(31),d=a(316),g=a(317),b=a(381),h=a(323),f=a.n(h),k=a(340),v=a.n(k);function E(e){const{autoFocus:t,help:a,id:r,isTextArea:i,maxLength:c,optional:s,overwriteOnly:o=!1,propKey:u,value:m}=e,[d,g]=n.useState(!o);return n.createElement("div",{className:"modal-field"},n.createElement("label",{className:"display-flex-center",htmlFor:r},Object(p.translate)("settings.almintegration.form",r),!s&&n.createElement(v.a,null),a&&n.createElement(f.a,{className:"spacer-left",overlay:a,placement:"right"})),!d&&o&&n.createElement("div",null,n.createElement("p",null,Object(p.translate)("settings.almintegration.form.secret_field")),n.createElement(l.ButtonLink,{onClick:()=>{e.onFieldChange(u,""),g(!0)}},Object(p.translate)("settings.almintegration.form.update_secret_field"))),d&&i&&n.createElement("textarea",{className:"settings-large-input",id:r,maxLength:c||2e3,onChange:t=>e.onFieldChange(u,t.currentTarget.value),required:!s,rows:5,value:m}),d&&!i&&n.createElement("input",{autoFocus:t,className:"input-super-large",id:r,maxLength:c||100,name:r,onChange:t=>e.onFieldChange(u,t.currentTarget.value),size:50,type:"text",value:m}))}function y(e){const{formData:t,onFieldChange:a}=e;return n.createElement("div",{className:"display-flex-start"},n.createElement("div",{className:"flex-1"},n.createElement(E,{autoFocus:!0,help:Object(p.translate)("settings.almintegration.form.name.azure.help"),id:"name.azure",onFieldChange:a,propKey:"key",value:t.key}),n.createElement(E,{help:n.createElement(n.Fragment,null,Object(p.translate)("settings.almintegration.form.url.azure.help1"),n.createElement("br",null),n.createElement("em",null,"https://ado.your-company.com/your_collection"),n.createElement("br",null),n.createElement("br",null),Object(p.translate)("settings.almintegration.form.url.azure.help2"),n.createElement("br",null),n.createElement("em",null,"https://dev.azure.com/your_organization")),id:"url.azure",maxLength:2e3,onFieldChange:a,propKey:"url",value:t.url||""}),n.createElement(E,{help:Object(p.translate)("settings.almintegration.form.personal_access_token.azure.help"),id:"personal_access_token",isTextArea:!0,onFieldChange:a,overwriteOnly:Boolean(t.key),propKey:"personalAccessToken",value:t.personalAccessToken})),n.createElement(o.Alert,{className:"huge-spacer-left flex-1",variant:"info"},n.createElement(d.FormattedMessage,{defaultMessage:Object(p.translate)("settings.almintegration.azure.info"),id:"settings.almintegration.azure.info",values:{link:n.createElement(g.c,{target:"_blank",to:b.a[i.a.Azure]},Object(p.translate)("learn_more"))}})))}var O=a(393),_=a.n(O);function j(e){const{formData:t}=e;return n.createElement(n.Fragment,null,n.createElement(E,{autoFocus:!0,help:Object(p.translate)("settings.almintegration.form.name.bitbucketcloud.help"),id:"name.bitbucket",maxLength:100,onFieldChange:e.onFieldChange,propKey:"key",value:t.key||""}),n.createElement(E,{help:n.createElement(d.FormattedMessage,{defaultMessage:Object(p.translate)("settings.almintegration.form.workspace.bitbucketcloud.help"),id:"settings.almintegration.form.workspace.bitbucketcloud.help",values:{example:n.createElement(n.Fragment,null,"https://bitbucket.org/",n.createElement("strong",null,"{workspace}"),"/{repository}")}}),id:"workspace.bitbucketcloud",maxLength:2e3,onFieldChange:e.onFieldChange,propKey:"workspace",value:t.workspace||""}),n.createElement(E,{id:"client_id.bitbucketcloud",help:Object(p.translate)("settings.almintegration.form.oauth_key.bitbucketcloud.help"),onFieldChange:e.onFieldChange,propKey:"clientId",value:t.clientId||""}),n.createElement(E,{id:"client_secret.bitbucketcloud",help:Object(p.translate)("settings.almintegration.form.oauth_secret.bitbucketcloud.help"),onFieldChange:e.onFieldChange,overwriteOnly:Boolean(t.key),propKey:"clientSecret",value:t.clientSecret||""}))}function C(e){const{formData:t}=e;return n.createElement(n.Fragment,null," ",n.createElement(E,{autoFocus:!0,help:Object(p.translate)("settings.almintegration.form.name.bitbucket.help"),id:"name.bitbucket",maxLength:100,onFieldChange:e.onFieldChange,propKey:"key",value:t.key||""}),n.createElement(E,{help:n.createElement(d.FormattedMessage,{defaultMessage:Object(p.translate)("settings.almintegration.form.url.bitbucket.help"),id:"settings.almintegration.form.url.bitbucket.help",values:{example:"https://bitbucket-server.your-company.com"}}),id:"url.bitbucket",maxLength:2e3,onFieldChange:e.onFieldChange,propKey:"url",value:t.url||""}),n.createElement(E,{id:"personal_access_token",help:n.createElement(d.FormattedMessage,{defaultMessage:Object(p.translate)("settings.almintegration.form.personal_access_token.bitbucket.help"),id:"settings.almintegration.form.personal_access_token.bitbucket.help",values:{pat:n.createElement("a",{href:"https://confluence.atlassian.com/bitbucketserver0515/personal-access-tokens-961275199.html",rel:"noopener noreferrer",target:"_blank"},Object(p.translate)("settings.almintegration.form.personal_access_token.bitbucket.help.url"))}}),isTextArea:!0,onFieldChange:e.onFieldChange,overwriteOnly:Boolean(t.key),propKey:"personalAccessToken",value:t.personalAccessToken||""}))}function F(e){const{isUpdate:t,formData:a,variant:r}=e;return n.createElement(n.Fragment,null,!t&&n.createElement("div",{className:"display-flex-column"},n.createElement("strong",null,Object(p.translate)("settings.almintegration.form.choose_bitbucket_variant")),n.createElement(_.a,{className:"little-spacer-top big-spacer-bottom",name:"variant",onCheck:e.onVariantChange,options:[{label:"Bitbucket Server",value:i.a.BitbucketServer},{label:"Bitbucket Cloud",value:i.a.BitbucketCloud}],value:r})),void 0!==r&&n.createElement(n.Fragment,null,r===i.a.BitbucketServer&&n.createElement("div",{className:"display-flex-start"},n.createElement("div",{className:"flex-1"},n.createElement(C,{onFieldChange:e.onFieldChange,formData:a})),n.createElement(o.Alert,{className:"huge-spacer-left flex-1",variant:"info"},n.createElement(n.Fragment,null,n.createElement("h3",null,Object(p.translate)("onboarding.create_project.pat_help.title")),n.createElement("p",{className:"big-spacer-top"},Object(p.translate)("settings.almintegration.bitbucket.help_1")),n.createElement("ul",{className:"big-spacer-top list-styled"},n.createElement("li",null,Object(p.translate)("settings.almintegration.bitbucket.help_2")),n.createElement("li",null,Object(p.translate)("settings.almintegration.bitbucket.help_3"))),n.createElement("p",{className:"big-spacer-top big-spacer-bottom"},n.createElement(g.c,{target:"_blank",to:b.a[i.a.BitbucketServer]},Object(p.translate)("learn_more")))))),r===i.a.BitbucketCloud&&n.createElement("div",{className:"display-flex-start"},n.createElement("div",{className:"flex-1"},n.createElement(j,{onFieldChange:e.onFieldChange,formData:a})),n.createElement(o.Alert,{className:"huge-spacer-left flex-1",variant:"info"},n.createElement(d.FormattedMessage,{defaultMessage:Object(p.translate)("settings.almintegration.bitbucketcloud.info"),id:"settings.almintegration.bitbucketcloud.info",values:{link:n.createElement(g.c,{target:"_blank",to:b.a[i.a.BitbucketCloud]},Object(p.translate)("learn_more"))}})))))}function S(e){const{formData:t,onFieldChange:a}=e;return n.createElement("div",{className:"display-flex-start"},n.createElement("div",{className:"flex-1"},n.createElement(E,{autoFocus:!0,help:Object(p.translate)("settings.almintegration.form.name.github.help"),id:"name.github",onFieldChange:a,propKey:"key",value:t.key}),n.createElement(E,{help:n.createElement(n.Fragment,null,Object(p.translate)("settings.almintegration.form.url.github.help1"),n.createElement("br",null),n.createElement("em",null,"https://github.company.com/api/v3"),n.createElement("br",null),n.createElement("br",null),Object(p.translate)("settings.almintegration.form.url.github.help2"),n.createElement("br",null),n.createElement("em",null,"https://api.github.com/")),id:"url.github",maxLength:2e3,onFieldChange:a,propKey:"url",value:t.url}),n.createElement(E,{id:"app_id",help:Object(p.translate)("settings.almintegration.form.app_id.github.help"),maxLength:80,onFieldChange:a,propKey:"appId",value:t.appId}),n.createElement(E,{id:"client_id.github",help:Object(p.translate)("settings.almintegration.form.client_id.github.help"),maxLength:80,onFieldChange:a,propKey:"clientId",value:t.clientId}),n.createElement(E,{id:"client_secret.github",help:Object(p.translate)("settings.almintegration.form.client_secret.github.help"),maxLength:80,onFieldChange:a,overwriteOnly:Boolean(t.key),propKey:"clientSecret",value:t.clientSecret}),n.createElement(E,{id:"private_key",help:Object(p.translate)("settings.almintegration.form.private_key.github.help"),isTextArea:!0,onFieldChange:a,overwriteOnly:Boolean(t.key),propKey:"privateKey",value:t.privateKey})),n.createElement(o.Alert,{className:"huge-spacer-left flex-1",variant:"info"},n.createElement(d.FormattedMessage,{defaultMessage:Object(p.translate)("settings.almintegration.github.info"),id:"settings.almintegration.github.info",values:{link:n.createElement(g.c,{target:"_blank",to:b.a[i.a.GitHub]},Object(p.translate)("learn_more"))}})))}function x(e){const{formData:t,onFieldChange:a}=e;return n.createElement("div",{className:"display-flex-start"},n.createElement("div",{className:"flex-1"},n.createElement(E,{autoFocus:!0,help:Object(p.translate)("settings.almintegration.form.name.gitlab.help"),id:"name.gitlab",onFieldChange:a,propKey:"key",value:t.key}),n.createElement(E,{help:n.createElement(n.Fragment,null,Object(p.translate)("settings.almintegration.form.url.gitlab.help"),n.createElement("br",null),n.createElement("em",null,"https://gitlab.com/api/v4")),id:"url.gitlab",maxLength:2e3,onFieldChange:a,propKey:"url",value:t.url||""}),n.createElement(E,{help:Object(p.translate)("settings.almintegration.form.personal_access_token.gitlab.help"),id:"personal_access_token",isTextArea:!0,onFieldChange:a,overwriteOnly:Boolean(t.key),propKey:"personalAccessToken",value:t.personalAccessToken})),n.createElement(o.Alert,{className:"huge-spacer-left flex-1",variant:"info"},n.createElement(d.FormattedMessage,{defaultMessage:Object(p.translate)("settings.almintegration.gitlab.info"),id:"settings.almintegration.gitlab.info",values:{link:n.createElement(g.c,{target:"_blank",to:b.a[i.a.GitLab]},Object(p.translate)("learn_more"))}})))}class w extends n.PureComponent{constructor(){super(...arguments),this.renderForm=()=>{const{alm:e,formData:t,isUpdate:a,bitbucketVariant:r}=this.props;switch(e){case i.a.GitLab:return n.createElement(x,{onFieldChange:this.props.onFieldChange,formData:t});case i.a.Azure:return n.createElement(y,{onFieldChange:this.props.onFieldChange,formData:t});case i.a.GitHub:return n.createElement(S,{onFieldChange:this.props.onFieldChange,formData:t});case i.a.BitbucketServer:return n.createElement(F,{onFieldChange:this.props.onFieldChange,formData:t,isUpdate:a,variant:r,onVariantChange:this.props.onBitbucketVariantChange});default:return null}}}render(){const{isUpdate:e,alreadyHaveInstanceConfigured:t,canSubmit:a,submitting:r,validationError:i}=this.props,c=Object(p.translate)("settings.almintegration.form.header",e?"edit":"create");return n.createElement(s.a,{contentLabel:c,onRequestClose:this.props.onCancel,shouldCloseOnOverlayClick:!1,size:"medium"},n.createElement("form",{className:"views-form",onSubmit:e=>{e.preventDefault(),this.props.onSubmit()}},n.createElement("div",{className:"modal-head"},n.createElement("h2",null,c)),n.createElement("div",{className:"modal-body modal-container"},t&&!e&&n.createElement(o.Alert,{className:"big-spacer-bottom",variant:"warning"},Object(p.translate)("settings.almintegration.form.second_instance_warning")),this.renderForm(),i&&!a&&n.createElement(o.Alert,{variant:"error"},n.createElement("p",{className:"spacer-bottom"},Object(p.translate)("settings.almintegration.configuration_invalid")),n.createElement("ul",{className:"list-styled"},n.createElement("li",null,i)))),n.createElement("div",{className:"modal-foot"},n.createElement(l.SubmitButton,{disabled:!a||r},Object(p.translate)("settings.almintegration.form.save"),n.createElement(m.a,{className:"spacer-left",loading:r})),n.createElement(l.ResetButtonLink,{onClick:this.props.onCancel},Object(p.translate)("cancel")))))}}function N(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function A(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?N(Object(a),!0).forEach((function(t){B(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const D={[i.a.Azure]:{createApi:r.b,updateApi:r.r,defaultBinding:{key:"",personalAccessToken:"",url:""}},[i.a.GitHub]:{createApi:r.e,updateApi:r.u,defaultBinding:{key:"",appId:"",clientId:"",clientSecret:"",url:"",privateKey:""}},[i.a.GitLab]:{createApi:r.f,updateApi:r.v,defaultBinding:{key:"",personalAccessToken:"",url:""}},[i.a.BitbucketServer]:{createApi:r.d,updateApi:r.t,defaultBinding:{key:"",url:"",personalAccessToken:""}},[i.a.BitbucketCloud]:{createApi:r.c,updateApi:r.s,defaultBinding:{key:"",clientId:"",clientSecret:"",workspace:""}}};class K extends n.PureComponent{constructor(e){var t;super(e),this.mounted=!1,this.handleFieldChange=(e,t)=>{this.setState(({formData:a})=>({formData:A({},a,{[e]:t}),touched:!0}))},this.handleFormSubmit=async()=>{var e;const{alm:t,enforceValidation:a}=this.props,{formData:n,bitbucketVariant:i,alreadySavedFormData:l,validationError:c}=this.state,s=null!=i?i:t;let o;o=l&&c?D[s].updateApi(A({newKey:n.key},n,{key:l.key})):(null===(e=this.props.bindingDefinition)||void 0===e?void 0:e.key)?D[s].updateApi(A({newKey:n.key},n,{key:this.props.bindingDefinition.key})):D[s].createApi(A({},n)),this.setState({submitting:!0});try{if(await o,!this.mounted)return;let e;if(this.setState({alreadySavedFormData:n}),a&&(e=await Object(r.w)(n.key)),!this.mounted)return;e?this.setState({validationError:e}):this.props.afterSubmit(n)}finally{this.mounted&&this.setState({submitting:!1,touched:!1})}},this.handleOnCancel=async()=>{const{alreadySavedFormData:e}=this.state;e&&await Object(r.g)(e.key),this.props.onCancel()},this.handleBitbucketVariantChange=e=>{this.setState({bitbucketVariant:e,formData:A({},D[e].defaultBinding)})},this.canSubmit=()=>{const{formData:e,touched:t}=this.state;return t&&!Object.values(e).some(e=>!e)};let a=void 0;e.bindingDefinition&&e.alm===i.a.BitbucketServer&&(a=Object(i.d)(e.bindingDefinition)?i.a.BitbucketCloud:i.a.BitbucketServer);const n=a||e.alm;this.state={formData:null!==(t=e.bindingDefinition)&&void 0!==t?t:D[n].defaultBinding,touched:!1,submitting:!1,bitbucketVariant:a}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{alm:e,bindingDefinition:t,alreadyHaveInstanceConfigured:a}=this.props,{formData:r,submitting:i,bitbucketVariant:l,validationError:c}=this.state,s=!!t;return n.createElement(w,{alm:e,isUpdate:s,canSubmit:this.canSubmit(),alreadyHaveInstanceConfigured:a,onCancel:this.handleOnCancel,onSubmit:this.handleFormSubmit,onFieldChange:this.handleFieldChange,formData:r,submitting:i,bitbucketVariant:l,onBitbucketVariantChange:this.handleBitbucketVariantChange,validationError:c})}}},548:function(e,t,a){"use strict";a.d(t,"i",(function(){return i})),a.d(t,"j",(function(){return l})),a.d(t,"k",(function(){return c})),a.d(t,"w",(function(){return s})),a.d(t,"e",(function(){return o})),a.d(t,"u",(function(){return u})),a.d(t,"b",(function(){return m})),a.d(t,"r",(function(){return p})),a.d(t,"d",(function(){return d})),a.d(t,"t",(function(){return g})),a.d(t,"c",(function(){return b})),a.d(t,"s",(function(){return h})),a.d(t,"f",(function(){return f})),a.d(t,"v",(function(){return k})),a.d(t,"g",(function(){return v})),a.d(t,"a",(function(){return E})),a.d(t,"l",(function(){return y})),a.d(t,"h",(function(){return O})),a.d(t,"m",(function(){return _})),a.d(t,"n",(function(){return j})),a.d(t,"o",(function(){return C})),a.d(t,"p",(function(){return F})),a.d(t,"q",(function(){return S})),a.d(t,"x",(function(){return x}));var n=a(9),r=a(324);function i(){return Object(n.getJSON)("/api/alm_settings/list_definitions")}function l(e){return c(e).catch(r.a)}function c(e){return Object(n.getJSON)("/api/alm_settings/list",{project:e}).then(({almSettings:e})=>e)}function s(e){return Object(n.get)("/api/alm_settings/validate",{key:e}).then(()=>"").catch(e=>e.status===n.HttpStatus.BadRequest?Object(n.parseError)(e):Object(r.a)(e))}function o(e){return Object(n.post)("/api/alm_settings/create_github",e).catch(r.a)}function u(e){return Object(n.post)("/api/alm_settings/update_github",e).catch(r.a)}function m(e){return Object(n.post)("/api/alm_settings/create_azure",e).catch(r.a)}function p(e){return Object(n.post)("/api/alm_settings/update_azure",e).catch(r.a)}function d(e){return Object(n.post)("/api/alm_settings/create_bitbucket",e).catch(r.a)}function g(e){return Object(n.post)("/api/alm_settings/update_bitbucket",e).catch(r.a)}function b(e){return Object(n.post)("/api/alm_settings/create_bitbucketcloud",e).catch(r.a)}function h(e){return Object(n.post)("/api/alm_settings/update_bitbucketcloud",e).catch(r.a)}function f(e){return Object(n.post)("/api/alm_settings/create_gitlab",e).catch(r.a)}function k(e){return Object(n.post)("/api/alm_settings/update_gitlab",e).catch(r.a)}function v(e){return Object(n.post)("/api/alm_settings/delete",{key:e}).catch(r.a)}function E(e){return Object(n.getJSON)("/api/alm_settings/count_binding",{almSetting:e}).then(({projects:e})=>e).catch(r.a)}function y(e){return Object(n.getJSON)("/api/alm_settings/get_binding",{project:e})}function O(e){return Object(n.post)("/api/alm_settings/delete_binding",{project:e}).catch(r.a)}function _(e){return Object(n.post)("/api/alm_settings/set_azure_binding",e).catch(r.a)}function j(e){return Object(n.post)("/api/alm_settings/set_bitbucket_binding",e).catch(r.a)}function C(e){return Object(n.post)("/api/alm_settings/set_bitbucketcloud_binding",e).catch(r.a)}function F(e){return Object(n.post)("/api/alm_settings/set_github_binding",e).catch(r.a)}function S(e){return Object(n.post)("/api/alm_settings/set_gitlab_binding",e).catch(r.a)}function x(e){return Object(n.get)("/api/alm_settings/validate_binding",{project:e}).then(()=>{}).catch(e=>e.status===n.HttpStatus.BadRequest?Object(n.parseJSON)(e):Object(r.a)(e))}},549:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return l})),a.d(t,"e",(function(){return c}));const n="almintegration",r="exclusions",i="languages",l="new_code_period",c="pull_request_decoration_binding"}}]);
//# sourceMappingURL=13.m.2978d02d.chunk.js.map